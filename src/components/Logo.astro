---
/* All source code comments are in English */
import { SITE } from 'metaintelligence:config';
import fs from 'node:fs/promises';
import path from 'node:path';

interface Props {
  mode?: 'horizontal' | 'vertical' | 'logo_only';
  size?: string;
}

const { mode = 'horizontal', size = "" } = Astro.props;

// 1. Unified Spacing Logic: Use 'gap' for consistent distance
const spacingClass = mode === 'vertical' ? 'gap-3' : 'gap-4'; 

// 2. Determine Logo Size
const defaultSize = mode === 'vertical' ? 'h-20 w-20' : 'h-14 w-14';
const finalSize = size || defaultSize;

const svgPath = path.resolve('./src/assets/favicons/logo_2025.svg');
let svgContent = '';
try {
  svgContent = await fs.readFile(svgPath, 'utf-8');
  svgContent = svgContent.replace(/<\?xml.*?\?>/, '');
} catch (error) {
  console.error('Error loading logo SVG:', error);
}

// 3. Consolidated Classes
const containerClasses = [
  'self-center text-gray-900 whitespace-nowrap dark:text-white flex items-center',
  spacingClass, // Apply consistent gap here
  mode === 'vertical' ? 'flex-col text-center' : 'flex-row',
].join(' ');

const textClasses = [
  'font-bold tracking-tight',
  mode === 'logo_only' ? 'hidden' : 'block',
  'text-2xl md:text-xl', // Unified text size for consistency
].join(' ');

const wrapperClasses = [
  'flex items-center justify-center custom-logo-wrapper shrink-0',
  finalSize,
].join(' ');
---

<span class={containerClasses}>
  <div class={wrapperClasses}>
    <Fragment set:html={svgContent} />
  </div>
  <span class={textClasses}>{SITE?.name}</span>
</span>

<style is:global>
  .custom-logo-wrapper svg {
    width: 100%;
    height: 100%;
  }
</style>

<script is:inline>
  /* Theme sync logic remains the same */
  const syncLogoTheme = () => {
    const svgElement = document.querySelector('.custom-logo-wrapper svg');
    if (!svgElement) return;
    const isDarkMode = document.documentElement.classList.contains('dark');
    if (isDarkMode) {
      svgElement.classList.add('dark'); svgElement.classList.remove('light');
    } else {
      svgElement.classList.add('light'); svgElement.classList.remove('dark');
    }
  };
  syncLogoTheme();
  const toggleButtons = document.querySelectorAll('[data-aw-toggle-color-scheme]');
  toggleButtons.forEach((btn) => btn.addEventListener('click', () => setTimeout(syncLogoTheme, 10)));
  new MutationObserver(syncLogoTheme).observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
</script>